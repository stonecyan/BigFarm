<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <title>BigFarm</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>


  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
    crossorigin="anonymous">
  <link rel="stylesheet" href="./css/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">

</head>

<body>
  <!-- navbar -->
  <div class="navigation">
    <a class="active" href="./index.html">Small Scale</a>
    <img src="./img/What the crop.png">
    <a href="./large-scale.html">Large Scale</a>
  </div>
  <div class="content">
    <!-- Sensor data -->
    <div class="sensorInfo">
      <p class="title" id="plantTitle">Carrot</p>
      <p class="sensorDescription">Temperature: <span class="sensorData" id="temp"></span></p>
      <p class="units">&#8457;</p>
      <p class="sensorDescription">Humidity: <span class="sensorData" id="humid"></span></p>
      <p class="units">%</p>
      <p class="sensorDescription">Soil Moisture: <span class="sensorData" id="soil"></span></p>
      <p class="units">m<sup>3</sup> water/m<sup>3</sup> soil</p>
      <p class="sensorDescription">Sunlight: <span class="sensorData" id="sun"></span></p>
      <p class="units">lux</p>
    </div>

    <!-- Farm Grid -->

    <div class="farm-container">
      <div class="node" onclick="changeNode()" id="node1">
        <figure>
          <img class="node-image" id="node1img" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Carrot.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" id="node2" onclick="changeNode()">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Cucumber.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" id="node3" onclick="changeNode()">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Potato.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" onclick="changeNode()" id="node4">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Lettuce.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" id="node5" onclick="changeNode()">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Lettuce.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" id="node6" onclick="changeNode()">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Lettuce.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" onclick="changeNode()" id="node7">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Radish.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" id="node8" onclick="changeNode()">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Tomato.jpg"></figcaption>
        </figure>
      </div>
      <div class="node" id="node9" onclick="changeNode()">
        <figure>
          <img class="node-image" src="./img/Good-Warm.png">
          <figcaption><img src="./img/Broccoli.jpg"></figcaption>
        </figure>
      </div>
    </div>
  </div>

  <script>
    var temperature;
    var soil;
    var humidity;
    var sunlight;

    var temperature1 = "";
    var soil1 = "";
    var humidity1 = "";
    var sunlight1 = "";

    $(document).ready(function () {
      /* Initial load of data*/
      $.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/humidityfeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          temperature = data.last_value;
          console.log(temperature);
        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });
      
      $.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/lightonefeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          soil = data.last_value;
          var soilInt = parseInt(soil);
          var tempInt = parseInt(temperature);
          if (soilInt < 500 && tempInt>70){
            $("#node1img").attr("src", "./img/Dry-Hot.png");
          }
          else if (soilInt >= 500 && tempInt>70){
            $("#node1img").attr("src", "./img/Good-Hot.png");
          }
          else if (soilInt >= 500 && tempInt<=70 && tempInt >50){
            $("#node1img").attr("src", "./img/Good-Warm.png");
          }
          else if (soilInt < 500 && tempInt <= 70 && tempInt >50){
            $("#node1img").attr("src", "./img/Dry-Warm.png");
          }
          else if (soilInt < 500 && tempInt <=50){
            $("#node1img").attr("src", "./img/Dry-Cold.png");
          }
          else if (soilInt >= 500 && tempInt <=50){
            $("#node1img").attr("src", "./img/Good-Cold.png");
          }


        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });

      $.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/humidityfeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          humidity = data.last_value;
        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });

	     $.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/lighttwofeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          sunlight = data.last_value;
        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });


      /* Repeating ajax call */
      var refreshTemp = setInterval(function() {$.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/humidityfeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          temperature = data.last_value;
        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });}, 5000);
      

      var refreshSoil = setInterval(function() {$.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/lightonefeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          soil = data.last_value;
          var soilInt = parseInt(soil);
          var tempInt = parseInt(temperature);
          if (soilInt < 500 && tempInt>70){
            $("#node1img").attr("src", "./img/Dry-Hot.png");
          }
          else if (soilInt >= 500 && tempInt>70){
            $("#node1img").attr("src", "./img/Good-Hot.png");
          }
          else if (soilInt >= 500 && tempInt<=70 && tempInt >50){
            $("#node1img").attr("src", "./img/Good-Warm.png");
          }
          else if (soilInt < 500 && tempInt <= 70 && tempInt >50){
            $("#node1img").attr("src", "./img/Dry-Warm.png");
          }
          else if (soilInt < 500 && tempInt <=50){
            $("#node1img").attr("src", "./img/Dry-Cold.png");
          }
          else if (soilInt >= 500 && tempInt <=50){
            $("#node1img").attr("src", "./img/Good-Cold.png");
          }


        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });}, 5000);


      var refreshHumid = setInterval(function() {$.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/humidityfeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          humidity = data.last_value;
        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });}, 5000);

      var refreshSun = setInterval(function() {$.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/lighttwofeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          sunlight = data.last_value;
        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });}, 5000);

      /*$.ajax({
        crossOrigin: true,
        type: 'GET',
        url: 'https://io.adafruit.com/api/v2/atfriend1/feeds/moisturefeed?X-AIO-key=31f3868947f148738fab958c69531fa7',
        success: function (data) {
          moisture = data.last_value;
          console.log(moisture);
        },
        error: function (xhr) {
          alert("Error: " + xhr.status + " " + xhr.statusText);
        }
      });*/
        
      $("#node1").click(function changeNode() {
        $("#plantTitle").text("Carrot");
        $("#temp").text(temperature);
        $("#humid").text(humidity);
        $("#soil").text(soil);
        $("#sun").text(sunlight);
        var refreshSensorPlant = setInterval( function(){$("#plantTitle").text("Carrot");}, 5000);
        var refreshSensorTemp = setInterval( function(){$("#temp").text(temperature);}, 5000);
        var refreshSensorHumid = setInterval( function(){$("#humid").text(humidity);}, 5000);
        var refreshSensorSoil = setInterval( function(){$("#soil").text(soil);}, 5000);
        var refreshSun = setInterval( function(){$("#sun").text(sunlight);}, 5000);
      });
      $("#node2").click(function changeNode() {
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
      $("#node3").click(function changeNode() {
        $("#plantTitle").text("Potato");
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
      $("#node4").click(function changeNode() {
        $("#plantTitle").text("Lettuce");
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
      $("#node5").click(function changeNode() {
        $("#plantTitle").text("Lettuce");
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
      $("#node6").click(function changeNode() {
        $("#plantTitle").text("Lettuce");
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
      $("#node7").click(function changeNode() {
        $("#plantTitle").text("Radish");
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
      $("#node8").click(function changeNode() {
        $("#plantTitle").text("Tomato");
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
      $("#node9").click(function changeNode() {
        $("#plantTitle").text("Broccoli");
        $("#plantTitle").text("Cucumber");
        $("#temp").text(temperature1);
        $("#humid").text(humidity1);
        $("#soil").text(soil1);
        $("#sun").text(sunlight1);
      });
    });
  </script>

</body>